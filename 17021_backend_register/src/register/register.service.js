import { pool } from '../database.js';

export default class RegisterService {
  async addCustomer(registerData, registerFileData) {
    const sql = `INSERT INTO customer SET 
                      PayStatus = ?, 
                      RefNo1 = ?, 
                      CustomerID = ?, 
                      TestLang = ?,
                      SubjectID = ?,
                      SubjectNameTH = ?,
                      SubjectNameEN = ?,
                      Name1 = ?, 
                      Name2 = ?, 
                      Name3 = ?, 
                      Gender = ?, 
                      Name1EN = ?, 
                      Name2EN = ?, 
                      NameMidEN = ?, 
                      Name3EN = ?, 
                      BirthDMY = ?, 
                      Degree = ?, 
                      Major = ?, 
                      University = ?, 
                      DateIn = ?, 
                      Address = ?, 
                      Soi = ?, 
                      Road = ?, 
                      District = ?, 
                      Amphur = ?, 
                      Province = ?, 
                      Zipcode = ?, 
                      TelMobile = ?, 
                      Email = ?, 
                      SpecialNeeds = ?, 
                      NationalityID = ?, 
                      Nationality = ?, 
                      StatusStudy = ?, 
                      Grade = ?, 
                      FileImg = ?, 
                      FileImgStatus = ?, 
                      smsStatus = "2", 
                      IP = ?`;
    const currentDate = new Date();
    const thaiTime = currentDate.toLocaleTimeString('th-TH', { timeZone: 'Asia/Bangkok' });
    const formattedDate = `${(currentDate.getMonth() + 1).toString().padStart(2, '0')}${currentDate.getDate().toString().padStart(2, '0')}${thaiTime.split(':')[0]}`;
    const calRef = `${registerData.NationalityID}${formattedDate}${registerData.CustomerID}`;

    await pool.query(sql, [
      '*',
      calRef,
      registerData.CustomerID,
      registerData.TestLang,
      registerData.SubjectID,
      registerData.SubjectNameTH,
      registerData.SubjectNameEN,
      registerData.Name1.trim(),
      registerData.Name2.trim(),
      registerData.Name3.trim(),
      registerData.Gender,
      registerData.Name1EN.trim(),
      registerData.Name2EN.trim(),
      registerData.NameMidEN == null ? null : registerData.NameMidEN.trim(),
      registerData.Name3EN.trim(),
      registerData.BirthDMY,
      registerData.Degree,
      registerData.Major,
      registerData.University,
      registerData.DateIn,
      registerData.Address,
      registerData.Soi,
      registerData.Road,
      registerData.District,
      registerData.Amphur,
      registerData.Province,
      registerData.Zipcode,
      registerData.TelMobile,
      registerData.Email,
      registerData.SpecialNeeds,
      registerData.NationalityID,
      registerData.Nationality,
      registerData.StatusStudy,
      registerData.Grade,
      registerFileData.FileImg,
      registerFileData.FileImg != '-' ? 1 : '-',
      registerData.ip,
    ]);
  }
}
